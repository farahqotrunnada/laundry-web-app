// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum Role {
  Driver
  Customer
  SuperAdmin
  OutletAdmin
  WashingWorker
  IroningWorker
  PackingWorker
}

model User {
  user_id     String   @id @default(cuid())
  fullname    String
  email       String   @unique
  phone       String?
  role        Role     @default(Customer)
  password    String?
  google_id   String?  @unique
  avatar_url  String?
  is_verified Boolean  @default(false)
  created_at  DateTime @default(now())
  updated_at  DateTime @updatedAt

  Customer Customer?
  Employee Employee?
  Order    Order[]
  Ticket   Ticket[]

  @@map("users")
}

model Customer {
  customer_id String @id @default(cuid())
  user_id     String @unique

  User           User             @relation(fields: [user_id], references: [user_id], onDelete: Cascade)
  CustomerAdress CustomerAdress[]

  @@map("customers")
}

model CustomerAdress {
  customer_address_id String   @id @default(cuid())
  customer_id         String
  is_primary          Boolean  @default(false)
  name                String   @default("Home")
  address             String
  formatted           String?
  road                String?
  city                String?
  city_district       String?
  region              String?
  suburb              String?
  zipcode             String?
  latitude            Decimal  @db.Decimal(11, 7)
  longitude           Decimal  @db.Decimal(11, 7)
  created_at          DateTime @default(now())
  updated_at          DateTime @updatedAt

  Customer Customer @relation(fields: [customer_id], references: [customer_id], onDelete: Cascade)

  @@map("customer_addresses")
}

model Outlet {
  outlet_id     String   @id @default(cuid())
  name          String
  description   String
  address       String
  formatted     String?
  road          String?
  city          String?
  city_district String?
  region        String?
  suburb        String?
  zipcode       String?
  latitude      Decimal  @db.Decimal(11, 7)
  longitude     Decimal  @db.Decimal(11, 7)
  created_at    DateTime @default(now())
  updated_at    DateTime @updatedAt

  Employee      Employee[]
  Delivery      Delivery[]
  Order         Order[]
  Job           Job[]
  Resolution    Resolution[]
  RequestAccess RequestAccess[]

  @@map("outlets")
}

model Shift {
  shift_id   String   @id @default(cuid())
  start      Int
  end        Int
  created_at DateTime @default(now())
  updated_at DateTime @updatedAt

  Employee Employee[]

  @@map("shifts")
}

model Employee {
  employee_id String   @id @default(cuid())
  user_id     String   @unique
  outlet_id   String?
  shift_id    String?
  created_at  DateTime @default(now())
  updated_at  DateTime @updatedAt

  User          User            @relation(fields: [user_id], references: [user_id], onDelete: Cascade)
  Outlet        Outlet?         @relation(fields: [outlet_id], references: [outlet_id], onDelete: SetNull)
  Shift         Shift?          @relation(fields: [shift_id], references: [shift_id], onDelete: SetNull)
  Resolution    Resolution[]
  RequestAccess RequestAccess[]

  @@map("employees")
}

model Order {
  order_id   String   @id @default(cuid())
  outlet_id  String
  user_id    String
  price      Decimal  @db.Decimal(8, 2)
  created_at DateTime @default(now())
  updated_at DateTime @updatedAt

  User   User   @relation(fields: [user_id], references: [user_id], onDelete: Cascade)
  Outlet Outlet @relation(fields: [outlet_id], references: [outlet_id], onDelete: Cascade)

  OrderItem     OrderItem[]
  OrderProgress OrderProgress[]
  Payment       Payment[]
  Ticket        Ticket[]
  Delivery      Delivery[]
  Job           Job[]

  @@map("orders")
}

enum PaymentStatus {
  Pending
  Paid
  Cancelled
  Refunded
}

model Payment {
  payment_id String        @id @default(cuid())
  order_id   String
  method     String
  amount     Decimal       @db.Decimal(8, 2)
  status     PaymentStatus @default(Pending)
  created_at DateTime      @default(now())
  updated_at DateTime      @updatedAt

  Order Order @relation(fields: [order_id], references: [order_id], onDelete: Cascade)

  @@map("payments")
}

model LaundryItem {
  laundry_item_id String   @id @default(cuid())
  name            String
  icon_url        String
  created_at      DateTime @default(now())
  updated_at      DateTime @updatedAt

  OrderItem OrderItem[]

  @@map("laundry_items")
}

model OrderItem {
  order_item_id   String  @id @default(cuid())
  order_id        String
  laundry_item_id String
  quantity        Int
  weight          Decimal @db.Decimal(8, 2)

  Order       Order       @relation(fields: [order_id], references: [order_id], onDelete: Cascade)
  LaundryItem LaundryItem @relation(fields: [laundry_item_id], references: [laundry_item_id], onDelete: Cascade)

  @@map("order_items")
}

model OrderProgress {
  order_progrses_id String   @id @default(cuid())
  order_id          String
  name              String
  created_at        DateTime @default(now())
  updated_at        DateTime @updatedAt

  Order Order @relation(fields: [order_id], references: [order_id], onDelete: Cascade)

  @@map("order_progresses")
}

enum ProgressType {
  Pending
  Ongoing
  Completed
}

enum DeliveryType {
  Pickup
  Dropoff
}

model Delivery {
  delivery_id String       @id @default(cuid())
  order_id    String
  outlet_id   String
  progress    ProgressType @default(Pending)
  type        DeliveryType
  created_at  DateTime     @default(now())
  updated_at  DateTime     @updatedAt

  Outlet Outlet @relation(fields: [outlet_id], references: [outlet_id], onDelete: Cascade)
  Order  Order  @relation(fields: [order_id], references: [order_id], onDelete: Cascade)

  @@map("deliveries")
}

enum JobType {
  Washing
  Ironing
  Packing
}

model Job {
  job_id     String       @id @default(cuid())
  outlet_id  String
  order_id   String
  progress   ProgressType @default(Pending)
  type       JobType
  created_at DateTime     @default(now())
  updated_at DateTime     @updatedAt

  Outlet Outlet @relation(fields: [outlet_id], references: [outlet_id], onDelete: Cascade)
  Order  Order  @relation(fields: [order_id], references: [order_id], onDelete: Cascade)

  @@map("jobs")
}

model Ticket {
  ticket_id  String   @id @default(cuid())
  order_id   String
  user_id    String
  created_at DateTime @default(now())
  updated_at DateTime @updatedAt

  Order      Order        @relation(fields: [order_id], references: [order_id], onDelete: Cascade)
  User       User         @relation(fields: [user_id], references: [user_id], onDelete: Cascade)
  Resolution Resolution[]

  @@map("tickets")
}

model Resolution {
  resolution_id String   @id @default(cuid())
  outlet_id     String
  employee_id   String
  description   String
  ticket_id     String
  created_at    DateTime @default(now())
  updated_at    DateTime @updatedAt

  Ticket   Ticket   @relation(fields: [ticket_id], references: [ticket_id], onDelete: Cascade)
  Outlet   Outlet   @relation(fields: [outlet_id], references: [outlet_id], onDelete: Cascade)
  Employee Employee @relation(fields: [employee_id], references: [employee_id], onDelete: Cascade)

  @@map("resolutions")
}

enum RequestStatus {
  Pending
  Accepted
  Rejected
}

model RequestAccess {
  request_access_id String        @id @default(cuid())
  outlet_id         String
  employee_id       String
  status            RequestStatus @default(Pending)
  created_at        DateTime      @default(now())
  updated_at        DateTime      @updatedAt

  Outlet   Outlet   @relation(fields: [outlet_id], references: [outlet_id], onDelete: Cascade)
  Employee Employee @relation(fields: [employee_id], references: [employee_id], onDelete: Cascade)

  @@map("request_access")
}
